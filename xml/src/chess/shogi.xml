<game>
    <name>将棋 Shogi</name>
    <gamebody>
        <players>
            <player value="black" />
            <player value="white" />
        </players>
        <pieces>
            <p>
                2 × 王將 king
                <piece shape="king" />,
                2 × 角行 bishop
                <piece shape="bishop" />,
                2 × 飛車 rook
                <piece shape="rook" />,
                4 × 桂馬 knight 
                <piece shape="shogi-knight" />,
                4 × 香車 lance
                <piece shape="lance" />,
                4 × 金将 gold general
                <piece shape="gold-general" />,
                4 × 銀将 silver general
                <piece shape="silver-general" />,
                18 × 歩兵 pawn
                <piece shape="pawn" />
            </p>
            <p>
                Pieces can change ownership:
                <piece shape="king" /> =
                <piece colour="black" shape="king" /> =
                <piece colour="white" shape="king" />
            </p>
            <p>
                Pieces have 2 states:
                unpromoted and promoted
            </p>
        </pieces>
        <phase>
            <phaseName>
                <phaseNumber value="Setup" />
            </phaseName>
            <hide>
                <grid id="grid" rows="9" columns="9" size="small"
                      left="edge" right="edge" bottom="white-edge" top="black-edge"/>
            </hide>
            <grid use="grid">
                <square x="0" y="0"> <piece colour="black" shape="lance" /> <player value="black" /> </square>
                <square x="1" y="0"> <piece colour="black" shape="knight" /> </square>
                <square x="2" y="0"> <piece colour="black" shape="silver-general" /> </square>
                <square x="3" y="0"> <piece colour="black" shape="gold-general" /> </square>
                <square x="4" y="0"> <piece colour="black" shape="king" /> </square>
                <square x="5" y="0"> <piece colour="black" shape="gold-general" /> </square>
                <square x="6" y="0"> <piece colour="black" shape="silver-general" /> </square>
                <square x="7" y="0"> <piece colour="black" shape="knight" /> </square>
                <square x="8" y="0"> <piece colour="black" shape="lance" /> </square>
                <square x="1" y="1"> <piece colour="black" shape="bishop" /> </square>
                <square x="7" y="1"> <piece colour="black" shape="rook" /> </square>
                <square x="0" y="2"> <piece colour="black" shape="pawn" /> </square>
                <square x="1" y="2"> <piece colour="black" shape="pawn" /> </square>
                <square x="2" y="2"> <piece colour="black" shape="pawn" /> </square>
                <square x="3" y="2"> <piece colour="black" shape="pawn" /> </square>
                <square x="4" y="2"> <piece colour="black" shape="pawn" /> </square>
                <square x="5" y="2"> <piece colour="black" shape="pawn" /> </square>
                <square x="6" y="2"> <piece colour="black" shape="pawn" /> </square>
                <square x="7" y="2"> <piece colour="black" shape="pawn" /> </square>
                <square x="8" y="2"> <piece colour="black" shape="pawn" /> </square>

                <square x="0" y="8"> <piece colour="white" shape="lance" /> </square>
                <square x="1" y="8"> <piece colour="white" shape="knight" /> </square>
                <square x="2" y="8"> <piece colour="white" shape="silver-general" /> </square>
                <square x="3" y="8"> <piece colour="white" shape="gold-general" /> </square>
                <square x="4" y="8"> <piece colour="white" shape="king" /> </square>
                <square x="5" y="8"> <piece colour="white" shape="gold-general" /> </square>
                <square x="6" y="8"> <piece colour="white" shape="silver-general" /> </square>
                <square x="7" y="8"> <piece colour="white" shape="knight" /> </square>
                <square x="8" y="8"> <piece colour="white" shape="lance" /> </square>
                <square x="1" y="7"> <piece colour="white" shape="rook" /> </square>
                <square x="7" y="7"> <piece colour="white" shape="bishop" /> </square>
                <square x="0" y="6"> <piece colour="white" shape="pawn" /> </square>
                <square x="1" y="6"> <piece colour="white" shape="pawn" /> </square>
                <square x="2" y="6"> <piece colour="white" shape="pawn" /> </square>
                <square x="3" y="6"> <piece colour="white" shape="pawn" /> </square>
                <square x="4" y="6"> <piece colour="white" shape="pawn" /> </square>
                <square x="5" y="6"> <piece colour="white" shape="pawn" /> </square>
                <square x="6" y="6"> <piece colour="white" shape="pawn" /> </square>
                <square x="7" y="6"> <piece colour="white" shape="pawn" /> </square>
                <square x="8" y="6"> <piece colour="white" shape="pawn" /> </square>
            </grid>
                9 × 9
            <goToPhase>
                <phaseNumber value="1" />
                <player value="black" />
            </goToPhase>
        </phase>
        <phase>
            <phaseName>
                <phaseNumber value="1" />
                <player value="black" />
            </phaseName>
            <ul>
            <li>
            <ol>
            <li>
            <keyword>Move</keyword> or <keyword>capture</keyword> with one of the pieces
            you control
            </li>
            <li>
            <keyword>Promote</keyword>
            </li>
            </ol>
            </li>
            <li>
            <keyword>drop</keyword> a captured piece
            </li>
            </ul>
            <repeat>
                <goToPhase>
                    <phaseNumber value="1" />
                    <player value="white" />
                </goToPhase>
                <goToPhase>
                    <phaseNumber value="1" />
                    <player value="black" />
                </goToPhase>
            </repeat>
        </phase>
        <subphase>
            <phaseName>
                <phaseNumber value="1" />
            </phaseName>
            <piece shape="king" /> in
            <keyword>checkmate</keyword>
            <goToPhase>
                <phaseNumber value="Lose" />
            </goToPhase>
        </subphase>
        <dl>
            <dlentry>
                <dt><keyword>move</keyword></dt>
                <dd>
                    <ul>
                    <li>
                        Move an unpromoted piece normally, to an empty square
                        (but see <keyword>knight jump</keyword>)
                    </li>
                    <li>
                        Move a promoted
                        <square x="0" y="8"> <piece shape="silver-general" /> </square>
                        <square x="0" y="8"> <piece shape="shogi-knight" /> </square>
                        <square x="0" y="8"> <piece shape="lance" /> </square>
                        or
                        <square x="0" y="8"> <piece shape="pawn" /> </square>
                        as a
                        <square x="0" y="8"> <piece shape="gold-general" /> </square>
                        to an empty square
                    </li>
                    <li>
                        Move a promoted
                        <square x="0" y="8"> <piece shape="bishop" /> </square>
                        as a
                        <square x="0" y="8"> <piece shape="dragon-horse" /> </square>
                        to an empty square
                    </li>
                    <li>
                        Move a promoted
                        <square x="0" y="8"> <piece shape="rook" /> </square>
                        as a
                        <square x="0" y="8"> <piece shape="dragon-king" /> </square>
                        to an empty square
                    </li>
                    </ul>
                    <p>
                        You may not make a <keyword>move</keyword> which leaves you
                        in <keyword>check</keyword>
                    </p>
                </dd>
            </dlentry>
            <dlentry>
                <dt><keyword>knight jump</keyword></dt>
                <dd>
                        <piece shape="knight" />
                        may jump over any other pieces
                        to <keyword>move</keyword>
                        or <keyword>capture</keyword>;
                        other pieces must pass through
                        only empty spaces
                </dd>
            </dlentry>
            <dlentry>
                <dt><keyword>check</keyword></dt>
                <dd>
                    <p>
                        Your <piece shape="king" /> 
                        is in a position
                        where it could be captured on the next turn
                    </p>
                </dd>
            </dlentry>
            <dlentry>
                <dt><keyword>checkmate</keyword></dt>
                <dd>
                    <p>
                        You have no way to avoid ending your turn with your
                        <piece shape="king" /> in <keyword>check</keyword>
                    </p>
                    <goToPhase>
                        <phaseNumber value="Lose" />
                    </goToPhase>
                </dd>
            </dlentry>
            <dlentry>
                <dt><keyword>capture</keyword></dt>
                <dd>
                    <ol>
                    <li>
                        Move a piece as in <keyword>move</keyword>,
                        to a space occupied by an opponent's piece
                    </li>
                    <li>
                        Remove the opponent's piece and add to your
                        <keyword>prisoners</keyword>
                    </li>
                    </ol>
                    <p>
                        You may not make a <keyword>capture</keyword> which leaves you
                        in <keyword>check</keyword>
                    </p>
                </dd>
            </dlentry>
            <dlentry>
                <dt><keyword>drop</keyword></dt>
                <dd>
                    <ol>
                    <li>
                        Take a piece from your <keyword>prisoners</keyword>
                        you have captured and place it 
                        on a <keyword>drop space</keyword>
                        for that piece
                    </li>
                    <li>
                        The dropped piece becomes one of your pieces
                    </li>
                    <li>
                        If the dropped piece was promoted, it becomes unpromoted
                    </li>
                    </ol>
                    <p>
                        You may not make a <keyword>drop</keyword> which leaves you
                        in <keyword>check</keyword>
                    </p>
                </dd>
            </dlentry>
            <dlentry>
                <dt><keyword>drop space</keyword></dt>
                <dd>
                    For
                    <piece shape="bishop" />
                    <piece shape="rook" />
                    <piece shape="shogi-knight" />
                    <piece shape="lance" />
                    <piece shape="gold-general" /> or
                    <piece shape="silver-general" />,
                    any space from which the
                    piece would be able to make a
                    normal move
                </dd>
                <dd>
                    <p>For
                    <piece shape="pawn" />,
                    any space such that</p>
                    <ol>
                    <li>the 
                    <piece shape="pawn" />
                    would be able to make a normal move</li>
                    <li>no other
                    <piece shape="pawn" /> is in any of the
                    spaces
                    forward or backward of the dropped
                    <piece shape="pawn" /></li>
                    <li>the dropped
                    <piece shape="pawn" />
                    does not immediately cause
                    <keyword>checkmate</keyword></li>
                    </ol>
                </dd>
            </dlentry>
            <dlentry>
                <dt><keyword>promote</keyword></dt>
                <dd>
                <ol>
                <li>
                        Promote any
                        <piece shape="pawn" />
                        or
                        <piece shape="lance" />
                        which ended the turn in the forwardmost row of the board
                </li>
                <li>
                        Promote any
                        <piece shape="shogi-knight" />
                        which ended the turn in the forwardmost 2 rows of the board
                </li>
                <li>
                        Optionally promote any piece
                        which began or ended the turn in the forwardmost 3 rows of the board
                </li>
                </ol>
                </dd>
            </dlentry>
        </dl>
        <log>
            <status value="in-progress" />
            <sources>
                <source>
                    <title>Shogi</title>
                    <copyright-holder>Wikipedia</copyright-holder>
                    <copyright-year>2010</copyright-year>
                </source>
                <source>
                    <title>Shogi</title>
                    <copyright-holder>chessvariants.com</copyright-holder>
                    <copyright-year>2010</copyright-year>
                </source>
            </sources>
            <changelog>
                <change>  
                    <changedate>2010-09-01</changedate>
                    <changetext>Rules ready, needs examples</changetext>
                </change>
            </changelog>
        </log>
    </gamebody>
</game>
